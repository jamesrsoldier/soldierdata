<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Formatting Paradox Gap Analyzer</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Outfit:wght@300;400;500;600&family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#0a0c10;
  --card:#141821;
  --card-elevated:#1a1f2b;
  --accent:#00e5a0;
  --accent-dim:rgba(0,229,160,.15);
  --accent-hover:#00cc8e;
  --green:#00e5a0;
  --yellow:#f0b429;
  --red:#ff4d4d;
  --text:#e8eaf0;
  --text-muted:#8a90a0;
  --text-dim:#555b6e;
  --border:#1e2333;
  --border-accent:rgba(0,229,160,.2);
}
body{
  font-family:'Outfit',sans-serif;
  background:var(--bg);
  color:var(--text);
  line-height:1.6;
  min-height:100vh;
}
.container{max-width:860px;margin:0 auto;padding:24px 20px 60px}

/* Header */
header{text-align:center;padding:56px 0 40px}
.section-label{
  display:inline-flex;align-items:center;gap:10px;
  font-family:'JetBrains Mono',monospace;font-size:.68rem;font-weight:500;
  color:var(--accent);text-transform:uppercase;letter-spacing:4px;
  margin-bottom:20px;
}
.section-label::before{content:'——';color:var(--accent);letter-spacing:-2px}
header h1{
  font-family:'Rajdhani',sans-serif;font-size:clamp(2rem,5vw,3rem);
  font-weight:700;letter-spacing:-0.5px;margin-bottom:6px;color:var(--text);line-height:1.15;
}
header h1 span{color:var(--accent)}
header p.subtitle{
  font-family:'Outfit',sans-serif;color:var(--text-muted);
  font-size:clamp(0.9rem,2vw,1.05rem);max-width:560px;margin:0 auto;font-weight:400;
}

/* Card */
.card{
  background:var(--card);border:1px solid var(--border);
  padding:28px;margin-bottom:24px;
}
.card h2{
  font-family:'Rajdhani',sans-serif;font-size:1.15rem;font-weight:600;
  margin-bottom:16px;letter-spacing:0.5px;
}

/* Content input */
.content-input{
  width:100%;min-height:220px;max-height:500px;padding:16px;
  background:var(--bg);border:1px solid var(--border);
  color:var(--text);font-family:'Outfit',sans-serif;font-size:0.95rem;line-height:1.7;
  overflow-y:auto;transition:border-color .2s;white-space:pre-wrap;word-wrap:break-word;
}
.content-input:focus{outline:none;border-color:var(--accent)}
.content-input:empty::before{
  content:attr(data-placeholder);color:var(--text-dim);pointer-events:none;
}

/* Buttons */
.btn{
  display:inline-flex;align-items:center;justify-content:center;gap:8px;
  padding:12px 28px;border:none;
  font-family:'Rajdhani',sans-serif;font-size:1rem;font-weight:600;
  text-transform:uppercase;letter-spacing:2px;
  cursor:pointer;transition:all .2s;text-decoration:none;
}
.btn-primary{background:var(--accent);color:var(--bg)}
.btn-primary:hover{background:var(--accent-hover);transform:translateY(-1px)}
.btn-primary:active{transform:translateY(0)}
.btn-primary:disabled{opacity:.5;cursor:not-allowed;transform:none}
.btn-ghost{
  background:transparent;color:var(--text);
  border:1px solid var(--border);
}
.btn-ghost:hover{border-color:var(--accent);color:var(--accent)}
.btn-cta{
  background:var(--accent);color:var(--bg);
  padding:16px 36px;font-size:1.05rem;
  width:100%;max-width:420px;
}
.btn-cta:hover{background:var(--accent-hover);transform:translateY(-1px)}
.btn-row{display:flex;gap:12px;margin-top:16px;flex-wrap:wrap;align-items:center}
.char-count{
  font-family:'JetBrains Mono',monospace;color:var(--text-dim);font-size:.75rem;
  letter-spacing:0.5px;
}

/* Results */
#results{display:none}
.scores-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:28px}
@media(max-width:560px){.scores-grid{grid-template-columns:1fr}}
.score-card{
  background:var(--card);border:1px solid var(--border);
  padding:28px;text-align:center;position:relative;overflow:hidden;
}
.score-card::before{
  content:'';position:absolute;top:0;left:0;right:0;height:2px;
}
.score-card.green{border-color:var(--border-accent)}
.score-card.green::before{background:var(--green)}
.score-card.yellow::before{background:var(--yellow)}
.score-card.red::before{background:var(--red)}
.score-value{font-family:'Rajdhani',sans-serif;font-size:3.2rem;font-weight:700;line-height:1}
.score-value.green{color:var(--green)}
.score-value.yellow{color:var(--yellow)}
.score-value.red{color:var(--red)}
.score-label{
  font-family:'Rajdhani',sans-serif;font-size:.95rem;font-weight:600;
  margin:10px 0 6px;letter-spacing:0.5px;
}
.score-desc{font-size:.82rem;color:var(--text-muted);line-height:1.5}

/* Offenders */
.offenders{margin-top:8px}
.offender-item{
  background:var(--bg);border-left:2px solid var(--red);
  padding:14px 16px;margin-bottom:10px;
}
.offender-item .sentence{font-size:.9rem;margin-bottom:6px;font-style:italic;color:var(--text)}
.offender-item .reason{font-size:.8rem;color:var(--text-muted)}
.offender-item .badges{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
.badge{
  display:inline-block;padding:3px 10px;font-size:.65rem;font-weight:600;
  text-transform:uppercase;letter-spacing:1px;
  font-family:'JetBrains Mono',monospace;
}
.badge-format{background:rgba(255,77,77,.12);color:var(--red);border:1px solid rgba(255,77,77,.25)}
.badge-citation{background:rgba(240,180,41,.1);color:var(--yellow);border:1px solid rgba(240,180,41,.25)}

/* Summary bar */
.summary-bar{
  display:flex;gap:16px;flex-wrap:wrap;padding:16px 20px;
  background:var(--card);border:1px solid var(--border);margin-bottom:24px;
  font-size:.82rem;font-family:'JetBrains Mono',monospace;
}
.summary-bar span{color:var(--text-dim);letter-spacing:0.5px}
.summary-bar strong{color:var(--text);margin-left:4px}

/* Email capture */
.email-section{text-align:center;padding:32px 0 12px;border-top:1px solid var(--border);margin-top:32px}
.email-section p{color:var(--text-muted);font-size:.95rem;margin-bottom:16px}
.email-form{display:flex;gap:10px;max-width:460px;margin:0 auto;flex-wrap:wrap;justify-content:center}
.email-form input[type="email"]{
  flex:1;min-width:220px;padding:12px 16px;
  background:var(--bg);border:1px solid var(--border);
  color:var(--text);font-family:'Outfit',sans-serif;font-size:.95rem;
}
.email-form input[type="email"]:focus{outline:none;border-color:var(--accent)}
.email-form input[type="email"]::placeholder{color:var(--text-dim)}
.email-msg{font-size:.85rem;margin-top:10px;min-height:20px;font-family:'JetBrains Mono',monospace}
.email-msg.ok{color:var(--green)}
.email-msg.err{color:var(--red)}

/* CTA */
.cta-section{text-align:center;margin-top:36px}
.cta-section p{color:var(--text-muted);font-size:.9rem;margin-bottom:16px}

/* Footer */
footer{
  text-align:center;padding:40px 0 0;
  color:var(--text-dim);font-size:.75rem;
  font-family:'JetBrains Mono',monospace;letter-spacing:1px;text-transform:uppercase;
}

/* Spinner */
.spinner{
  width:18px;height:18px;
  border:2px solid rgba(10,12,16,.3);border-top-color:var(--bg);
  border-radius:50%;animation:spin .6s linear infinite;display:none;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* Fade-in */
.fade-in{animation:fadeIn .4s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>
<div class="container">
  <header>
    <div class="section-label">Gap Analyzer</div>
    <h1>Formatting Paradox.<br><span>Quantified.</span></h1>
    <p class="subtitle">Discover how much of your content's value is trapped in formatting that AI models strip away &mdash; and how citation-ready it really is.</p>
  </header>

  <div class="card">
    <h2>Paste Your Content</h2>
    <div class="content-input" id="contentInput" contenteditable="true" data-placeholder="Paste your web page content here — raw text, HTML, or markdown all work..." role="textbox" aria-multiline="true"></div>
    <div class="btn-row">
      <button class="btn btn-primary" id="scanBtn" onclick="runAnalysis()">
        <span id="scanText">Scan Content</span>
        <span class="spinner" id="scanSpinner"></span>
      </button>
      <span class="char-count" id="charCount">0 characters</span>
    </div>
  </div>

  <div id="results" class="fade-in">
    <div class="summary-bar" id="summaryBar"></div>

    <div class="scores-grid">
      <div class="score-card" id="formatCard">
        <div class="score-value" id="formatScore">&mdash;</div>
        <div class="score-label">Formatting Reliance Score</div>
        <div class="score-desc" id="formatDesc"></div>
      </div>
      <div class="score-card" id="citationCard">
        <div class="score-value" id="citationScore">&mdash;</div>
        <div class="score-label">Citation Readiness Score</div>
        <div class="score-desc" id="citationDesc"></div>
      </div>
    </div>

    <div class="card">
      <h2>Top Problem Areas</h2>
      <div class="offenders" id="offendersList"></div>
    </div>

    <div class="email-section">
      <p>Enter your email to get a detailed breakdown sent to you</p>
      <form class="email-form" id="emailForm" onsubmit="submitEmail(event)">
        <input type="email" id="emailInput" placeholder="you@company.com" required>
        <button type="submit" class="btn btn-primary" id="emailBtn">Send Report</button>
      </form>
      <div class="email-msg" id="emailMsg"></div>
    </div>

    <div class="cta-section">
      <p>Want expert recommendations tailored to your content strategy?</p>
      <a href="#" class="btn btn-cta" id="ctaBtn">Get a Full Audit</a>
    </div>
  </div>

  <footer>&copy; 2026 Formatting Paradox Gap Analyzer</footer>
</div>

<script>
/* ───── helpers ───── */
const $ = id => document.getElementById(id);

/* ───── contenteditable paste & input handling ───── */
const contentEl = $('contentInput');

// Store the raw pasted HTML separately so analysis can use it
let rawContent = '';

contentEl.addEventListener('paste', function(e){
  e.preventDefault();
  const clip = e.clipboardData || window.clipboardData;
  // Prefer HTML if available, fall back to plain text
  const html = clip.getData('text/html');
  const text = clip.getData('text/plain');
  if(html){
    rawContent = html;
    // Show the raw HTML as visible text so the user sees what was captured
    this.textContent = html;
  } else {
    rawContent = text;
    this.textContent = text;
  }
  updateCharCount();
});

contentEl.addEventListener('input', updateCharCount);

function updateCharCount(){
  const len = contentEl.textContent.length;
  $('charCount').textContent = len.toLocaleString() + ' characters';
}

function getContent(){
  // If user pasted HTML, rawContent holds it; otherwise use the text content
  if(rawContent) return rawContent;
  return contentEl.textContent || '';
}

function stripHtmlTags(html){
  const tmp = document.createElement('div');
  tmp.innerHTML = html;
  return tmp.textContent || tmp.innerText || '';
}

/* ───── sentence splitter ───── */
function splitSentences(text){
  // split on . ! ? followed by whitespace or end, but not on decimals like 3.5
  const raw = text.split(/(?<=[^0-9])([.!?])(?=\s|$)/);
  const sentences = [];
  let buf = '';
  for(let i=0;i<raw.length;i++){
    buf += raw[i];
    if(/^[.!?]$/.test(raw[i])){
      const s = buf.trim();
      if(s.length > 8) sentences.push(s);
      buf = '';
    }
  }
  if(buf.trim().length > 8) sentences.push(buf.trim());
  return sentences;
}

/* ───── counting helpers ───── */
function countBullets(raw){
  const mdBullets = (raw.match(/^[\t ]*[-*\u2022]\s+/gm) || []).length;
  const liBullets = (raw.match(/<li[\s>]/gi) || []).length;
  return mdBullets + liBullets;
}

function countHeaders(raw){
  const mdHeaders = (raw.match(/^#{1,6}\s+/gm) || []).length;
  const htmlHeaders = (raw.match(/<h[1-6][\s>]/gi) || []).length;
  return mdHeaders + htmlHeaders;
}

function countBold(raw){
  const mdBold = (raw.match(/\*\*[^*]+\*\*/g) || []).length;
  const htmlStrong = (raw.match(/<(strong|b)[\s>]/gi) || []).length;
  return mdBold + htmlStrong;
}

function countFaq(raw){
  const qaPairs = (raw.match(/\b[QA]\s*:/gi) || []).length;
  const details = (raw.match(/<details[\s>]/gi) || []).length;
  const faqMentions = (raw.match(/frequently\s+asked/gi) || []).length;
  return Math.floor(qaPairs / 2) + details + faqMentions;
}

/* ───── citation readiness per sentence ───── */
function isCitationReady(sentence){
  const issues = [];
  // has a specific number or statistic?
  const hasNumber = /\b\d{1,3}(,\d{3})*(\.\d+)?%?\b/.test(sentence) || /\b(percent|percentage|billion|million|thousand)\b/i.test(sentence);
  // names a source?
  const hasSource = /\b(according to|study|research|report|survey|university|institute|journal|published|found that|data from|analysis by)\b/i.test(sentence);
  // is self-contained? (doesn't start with vague pronoun)
  const startsVague = /^\s*(It|This|That|They|These|Those|He|She|We|Its|Their)\b/.test(sentence);

  let score = 0;
  if(hasNumber) score++;
  if(hasSource) score++;
  if(!startsVague) score++;

  if(!hasNumber) issues.push('No specific data or statistic');
  if(!hasSource) issues.push('No named source');
  if(startsVague) issues.push('Starts with vague pronoun — not self-contained');

  return { ready: score >= 2, score, issues, hasNumber, hasSource, startsVague };
}

/* ───── formatting reliance per sentence ───── */
function sentenceFormatContext(sentence, raw){
  const issues = [];
  // Check if sentence likely lived inside a bullet
  const esc = sentence.replace(/[.*+?^${}()|[\]\\]/g,'\\$&').substring(0,40);
  const inBullet = new RegExp('[-*\\u2022]\\s+[^\\n]*' + esc).test(raw) || new RegExp('<li[^>]*>[^<]*' + esc, 'i').test(raw);
  const inHeader = new RegExp('#{1,6}\\s+[^\\n]*' + esc).test(raw) || new RegExp('<h[1-6][^>]*>[^<]*' + esc, 'i').test(raw);
  const inBold = new RegExp('\\*\\*[^*]*' + esc).test(raw) || new RegExp('<(strong|b)[^>]*>[^<]*' + esc, 'i').test(raw);
  const inFaq = new RegExp('[QA]\\s*:[^\\n]*' + esc, 'i').test(raw);

  let weight = 0;
  if(inBullet){ weight += 2; issues.push('Inside a bullet point — loses context when flattened'); }
  if(inHeader){ weight += 2; issues.push('Functions as a header — meaning lost without visual hierarchy'); }
  if(inBold){ weight += 1; issues.push('Relies on bold emphasis for meaning'); }
  if(inFaq){ weight += 2; issues.push('Part of Q&A structure — answer orphaned without question'); }
  return { weight, issues, inBullet, inHeader, inBold, inFaq };
}

/* ───── color helpers ───── */
function fmtColor(score){
  if(score <= 30) return 'green';
  if(score <= 60) return 'yellow';
  return 'red';
}
function citColor(score){
  if(score >= 60) return 'green';
  if(score >= 30) return 'yellow';
  return 'red';
}

/* ───── main analysis ───── */
function runAnalysis(){
  const raw = getContent().trim();
  if(!raw){ alert('Please paste some content to analyze.'); return; }

  // show spinner briefly for perceived work
  $('scanBtn').disabled = true;
  $('scanSpinner').style.display = 'inline-block';
  $('scanText').textContent = 'Analyzing';

  setTimeout(() => {
    const plain = stripHtmlTags(raw);
    const sentences = splitSentences(plain);
    const totalSentences = Math.max(sentences.length, 1);

    // Counts
    const bullets = countBullets(raw);
    const headers = countHeaders(raw);
    const bolds = countBold(raw);
    const faqs = countFaq(raw);
    const formatElements = bullets + headers + bolds + faqs;

    // Score 1: Formatting Reliance (0-100)
    const scalingFactor = 15;
    let formatScore = Math.min(100, Math.round((formatElements / totalSentences) * scalingFactor * 100) / 100);
    formatScore = Math.round(formatScore);

    // Score 2: Citation Readiness
    let citReady = 0;
    const sentenceData = sentences.map((s, i) => {
      const cit = isCitationReady(s);
      const fmt = sentenceFormatContext(s, raw);
      if(cit.ready) citReady++;
      return { text: s, index: i, citation: cit, format: fmt };
    });
    let citationScore = Math.round((citReady / totalSentences) * 100);

    // Worst offenders: combine format weight + inverse citation score
    const ranked = sentenceData
      .map(d => ({ ...d, badness: d.format.weight + (3 - d.citation.score) }))
      .sort((a, b) => b.badness - a.badness)
      .slice(0, 5);

    // ── Render ──
    const fc = fmtColor(formatScore);
    const cc = citColor(citationScore);

    $('formatScore').textContent = formatScore;
    $('formatScore').className = 'score-value ' + fc;
    $('formatCard').className = 'score-card ' + fc;
    $('formatDesc').textContent = formatScore <= 30
      ? 'Low reliance on formatting. Your content structure transfers well to AI outputs.'
      : formatScore <= 60
        ? 'Moderate reliance. Some structural meaning may be lost when AI summarizes your content.'
        : 'High reliance on formatting. Significant meaning is locked in bullets, headers, and bold text that AI models strip away.';

    $('citationScore').textContent = citationScore;
    $('citationScore').className = 'score-value ' + cc;
    $('citationCard').className = 'score-card ' + cc;
    $('citationDesc').textContent = citationScore >= 60
      ? 'Strong citation readiness. Most sentences can stand alone with supporting data.'
      : citationScore >= 30
        ? 'Moderate readiness. Many sentences lack the specificity AI models need to cite them confidently.'
        : 'Low readiness. Most sentences lack data, sources, or self-contained context — making them unlikely to be cited by AI.';

    // Summary bar
    $('summaryBar').innerHTML =
      `<span>Sentences: <strong>${totalSentences}</strong></span>` +
      `<span>Bullets: <strong>${bullets}</strong></span>` +
      `<span>Headers: <strong>${headers}</strong></span>` +
      `<span>Bold: <strong>${bolds}</strong></span>` +
      `<span>FAQ patterns: <strong>${faqs}</strong></span>` +
      `<span>Citation-ready: <strong>${citReady}/${totalSentences}</strong></span>`;

    // Offenders
    let offHtml = '';
    if(ranked.length === 0){
      offHtml = '<p style="color:var(--text-muted)">No significant issues found.</p>';
    } else {
      ranked.forEach(d => {
        const display = d.text.length > 160 ? d.text.substring(0, 157) + '...' : d.text;
        const allIssues = [...d.format.issues, ...d.citation.issues];
        let badges = '';
        if(d.format.weight > 0) badges += '<span class="badge badge-format">Format-dependent</span>';
        if(!d.citation.ready) badges += '<span class="badge badge-citation">Not citation-ready</span>';
        offHtml += `<div class="offender-item">
          <div class="sentence">&ldquo;${escHtml(display)}&rdquo;</div>
          <div class="reason">${allIssues.join(' &bull; ')}</div>
          <div class="badges">${badges}</div>
        </div>`;
      });
    }
    $('offendersList').innerHTML = offHtml;

    $('results').style.display = 'block';
    $('results').classList.remove('fade-in');
    void $('results').offsetWidth; // reflow
    $('results').classList.add('fade-in');
    $('results').scrollIntoView({ behavior: 'smooth', block: 'start' });

    $('scanBtn').disabled = false;
    $('scanSpinner').style.display = 'none';
    $('scanText').textContent = 'Scan Content';
  }, 600);
}

function escHtml(s){
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

/* ───── email capture ───── */
function submitEmail(e){
  e.preventDefault();
  const email = $('emailInput').value.trim();
  if(!email) return;

  $('emailBtn').disabled = true;
  $('emailBtn').textContent = 'Sending...';
  $('emailMsg').textContent = '';
  $('emailMsg').className = 'email-msg';

  fetch('https://formspree.io/f/PLACEHOLDER', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
    body: JSON.stringify({
      email: email,
      formatScore: $('formatScore').textContent,
      citationScore: $('citationScore').textContent,
      timestamp: new Date().toISOString()
    })
  })
  .then(r => {
    if(r.ok){
      $('emailMsg').textContent = '> Sent. Check your inbox for your detailed breakdown.';
      $('emailMsg').className = 'email-msg ok';
      $('emailInput').value = '';
    } else {
      throw new Error('Request failed');
    }
  })
  .catch(() => {
    $('emailMsg').textContent = '> Error. Something went wrong. Please try again.';
    $('emailMsg').className = 'email-msg err';
  })
  .finally(() => {
    $('emailBtn').disabled = false;
    $('emailBtn').textContent = 'Send Report';
  });
}
</script>
</body>
</html>
